<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>List of all users</title>
    <link th:replace="fragments/general.html :: linkBootstrap"></link>
    <style type="text/css">
        body {
            padding: 50px;
        }

        .persons {
            border: 1px solid steelblue;
            width: 300px;
            border-collapse: collapse;
        }

        .persons tr td, th {
            padding: 5px;
            border: 1px solid steelblue;
        }

        .persons td:last-child, td:first-child {
            width: 50px;
        }
    </style>
    <script th:replace="fragments/general.html :: scriptBootstrap"></script>
    <script>


    function fillTable(users) {
        let strTBody = ``
        let tbody = document.getElementById(`tbody`)

        users.forEach(user=>{
            strTBody += `
                <tr>
                    <td>${user.id}</td>
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${user.informAboutTasks}</td>

                    <td>
                        <a href="/users/edit/${user.id}">Edit</a>
                    </td>
                </tr>
            `})
        tbody.innerHTML=strTBody
    }

    function getAllUsers() {
        fetch("/api/users", {
            method: 'GET',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            }
         })
        .then(response => response.json())
        .then(json => {fillTable(json)})
    }


    </script>
</head>

<body onload="getAllUsers()">

<div th:replace="fragments/general.html :: navbar"></div>

<h3>Users:</h3>

<a href = "add.html" th:href = "@{/users/add}">Add new</a>

<table class="table table-striped table-hover">
    <thead>
    <tr>
        <th>ID</th>
        <th>Name</th>
        <th>EMail</th>
        <th>InformAboutTasks</th>
        <th>edit</th>
    </tr>
    </thead>
    <tbody id="tbody">
    <tr>
        <td colspan="3">
            <div class="d-flex justify-content-center">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Загрузка...</span>
                </div>
            </div>
        </td>
    </tr>
    </tbody>
</table>
</body>
</html>
